{% extends 'almaher/base_card_dml.html'%}

{% block pg_head %}
    Student Attendances
{% endblock %}

{% block export %}
<a href="{% url 'export_excel_attendance_student' %}" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
    <i class="fas fa-download fa-sm text-white">
    <span>Export attendance students to excel</span>
    </i>
</a>
{% endblock %}

{% block card_body %}
    <div class="table-responsive">
        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>Session</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    {% for item in day_attendance %}
                        <th>{{item}}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for item in name_attendance %}
                <tr>
                    <td>{{item.session_id.session_number}}</td>
                    <td>{{item.person_id.first_name}}</td>
                    <td>{{item.person_id.last_name}}</td>
                    <!--Get studet _d then list status day-->
                    {% for item_status in status_attendance %}
                        {% if item_status.person_id == item.person_id%}
                            {% if item_status.status == True %}
                                <td>
                                    <div class="form-check">
                                        <div class="d-flex justify-content-center">
                                            <input class="form-check-input" onclick="to_false({{item_status.attendance_id}})" type="checkbox" value="" id="{{item_status.attendance_id}}" checked>
                                        </div>
                                    </div>
                                </td>
                            {% else %}
                                <td>
                                    <div class="form-check">
                                        <div class="d-flex justify-content-center">
                                            <input class="form-check-input" onclick="to_true({{item_status.attendance_id}})" type="checkbox" value="" id="{{item_status.attendance_id}}">
                                        </div>
                                    </div>
                                    </a>
                                </td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block javaScript%}
    <script>
        function to_true(x){
            let attendance_id = x;
            $.ajax({
            url: "{% url 'change_status_true' %}",
            data:{
                'attendance_id':attendance_id
                },
            dataType: 'json',
            });
        };
        function to_false(x){
            let attendance_id = x;
            $.ajax({
            url: "{% url 'change_status_false' %}",
            data:{
                'attendance_id':attendance_id
                },
            dataType: 'json',
            });
        };
    </script>
{% endblock %}

    
